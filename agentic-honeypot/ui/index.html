<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agentic Honey-Pot Demo UI</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 900px; margin: 2rem auto; }
      textarea { width: 100%; height: 6rem; }
      pre { background:#f6f8fa;padding:1rem;border-radius:6px }
    </style>
  </head>
  <body>
    <h1>Agentic Honey-Pot â€” Demo UI</h1>
    <p>Send a test message to the prototype API and view the response.</p>

    <label>API URL (example: http://localhost:8000/events)</label>
    <input id="apiUrl" value="http://localhost:8000/events" style="width:100%" />

    <label>API Key</label>
    <input id="apiKey" value="secret-key" style="width:100%" />

    <label>Session ID</label>
    <input id="sessionId" value="demo-session-1" style="width:100%" />

    <label>Message</label>
    <textarea id="message">Your bank account will be blocked today. Verify immediately. Share your UPI ID: scammer@upi</textarea>

    <button id="send">Send</button>
    <button id="list">List Sessions</button>

    <h3>Response</h3>
    <pre id="response">(no response yet)</pre>
    <h3>Sessions</h3>
    <div>
      <button id="refresh-sessions">Refresh Sessions</button>
      <ul id="sessions-list"></ul>
    </div>
    <h3>Session Details</h3>
    <pre id="session-detail">(none selected)</pre>

    <script>
      document.getElementById('send').addEventListener('click', async () => {
        const apiUrl = document.getElementById('apiUrl').value;
        const apiKey = document.getElementById('apiKey').value;
        const sessionId = document.getElementById('sessionId').value;
        const text = document.getElementById('message').value;

        const payload = {
          sessionId,
          message: { sender: 'scammer', text, timestamp: new Date().toISOString() },
          conversationHistory: [],
          metadata: { channel: 'SMS', language: 'English', locale: 'IN' }
        };

        const resEl = document.getElementById('response');
        resEl.textContent = 'Sending...';
        try {
          const r = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-api-key': apiKey },
            body: JSON.stringify(payload)
          });
          const j = await r.json();
          resEl.textContent = JSON.stringify(j, null, 2);
          // after sending, refresh sessions
          loadSessions();
        } catch (e) {
          resEl.textContent = String(e);
        }
      });

      async function loadSessions(){
        const apiBase = document.getElementById('apiUrl').value.replace(/\/events\/?$/, "");
        const apiKey = document.getElementById('apiKey').value;
        const listEl = document.getElementById('sessions-list');
        listEl.innerHTML = 'Loading...';
        try{
          const r = await fetch(apiBase + '/sessions', { headers: { 'x-api-key': apiKey } });
          const j = await r.json();
          if(j.status !== 'success') { listEl.textContent = JSON.stringify(j); return }
          listEl.innerHTML = '';
          j.sessions.forEach(s => {
            const li = document.createElement('li');
            const btn = document.createElement('button');
            btn.textContent = s.sessionId + ' (' + s.totalMessages + ')';
            btn.onclick = () => loadSessionDetail(s.sessionId);
            li.appendChild(btn);
            listEl.appendChild(li);
          });
        }catch(e){ listEl.textContent = String(e) }
      }

      async function loadSessionDetail(id){
        const apiBase = document.getElementById('apiUrl').value.replace(/\/events\/?$/, "");
        const apiKey = document.getElementById('apiKey').value;
        const det = document.getElementById('session-detail');
        det.textContent = 'Loading...';
        try{
          const r = await fetch(apiBase + '/sessions/' + encodeURIComponent(id), { headers: { 'x-api-key': apiKey } });
          const j = await r.json();
          det.textContent = JSON.stringify(j, null, 2);
        }catch(e){ det.textContent = String(e) }
      }

      document.getElementById('refresh-sessions').addEventListener('click', loadSessions);
      document.getElementById('list').addEventListener('click', loadSessions);
    </script>
  </body>
</html>
